using System;
using System.Collections.Generic;

namespace HomeWork_1
{
    class Program
    {
       static void Main(string[] args)
        {
            const string CommandChooseFighter = "1";
            const string CommandFight = "2";
            const string CommandExit = "3";

            Player player1 = null;
            Player player2 = null;

            Arena arena = new Arena();

            string userInput;

            bool isExit = false;

            while (isExit == false)
            {
                Console.Clear();
                if (player1 != null && player2 != null)
                {
                    Console.WriteLine(
                         $"\n Боец 1 - {player1.ToString()}" +
                         $"\n Боец 2 - {player2.ToString()}");
                }


                Console.Write($"\n{CommandChooseFighter} - Выбрать бойцов " +
                              $"\n{CommandFight} - Начать бой " +
                              $"\n{CommandExit} - Выйти \n\nВаш выбор: ");
                userInput = Console.ReadLine();

                switch (userInput)
                {
                    case CommandChooseFighter:
                        player1 = arena.ChooseFighter();
                        player2 = arena.ChooseFighter();
                        break;
                    case CommandFight:
                        arena.Fight(player1, player2);
                        break;
                    case CommandExit:
                        isExit = true;
                        break;
                }                
            }
        }
    }

    class Arena
    {
        public Player ChooseFighter()
        {
            Player player = null;
            List<Player> classes = new List<Player>()
            {
                new Barbarian(), new Knight(), new Gladiator(), new Paladin(), new Berserk(),
                new Hunter(), new Rogue(), new Monk(), new Assasin(), new Trickster(),
                new Mage(), new Shaman(), new Warlock(), new Priest(), new Summoner()
            };

            string userInput;
            int userChoose;
            bool isExit = false;

            while (isExit == false)
            {
                Console.Clear();
                Console.WriteLine("Выберите бойца из списка: ");

                for (int i = 0; i < classes.Count; i++)
                {
                    Console.WriteLine($"{i + 1}. {classes[i].ToString()}");
                }

                Console.Write("\nВаш выбор: ");

                userInput = Console.ReadLine();

                if (int.TryParse(userInput, out userChoose))
                {
                    player = classes[userChoose - 1];
                    isExit = true;
                }
            }

            return player;
        }

        public void Fight(Player player1, Player player2)
        {
            int initiativePlayer1;
            int initiativePlayer2;
            int round = 1;
            bool isSomeoneDead = false;

            while (isSomeoneDead == false)
            {
                Console.Clear();
                Console.WriteLine($"Ход боя: {round}\n");

                player1.ShowInfo();
                player2.ShowInfo();

                do
                {
                    initiativePlayer1 = player1.RollInitiative();
                    initiativePlayer2 = player2.RollInitiative();
                }
                while (initiativePlayer1 == initiativePlayer2);

                Console.WriteLine("\nИнициатива бойцов: " +
                    $"\n{player1.ClassName} - {initiativePlayer1}" +
                    $"\n{player2.ClassName} - {initiativePlayer2}\n");

                if (initiativePlayer1 == 0)
                {
                    Console.WriteLine($"Первым атакует: {player2.ClassName}" +
                        $"\n{player1.ClassName} провал инициативы, пропускает ход.");
                    player2.Attack(player1);
                }
                else if (initiativePlayer2 == 0)
                {
                    Console.WriteLine($"Первым атакует: {player1.ClassName}" +
                        $"\n{player2.ClassName} провал инициативы, пропускает ход.");
                    player1.Attack(player2);
                }
                else if (initiativePlayer1 > initiativePlayer2)
                {
                    Console.WriteLine($"Первым ходит: {player1.ClassName}");
                    player1.Attack(player2);
                    player2.Attack(player1);
                }
                else if (initiativePlayer2 > initiativePlayer1)
                {
                    Console.WriteLine($"Первым ходит: {player2.ClassName}");
                    player2.Attack(player1);
                    player1.Attack(player2);
                }
                else
                {
                    continue;
                }

                Console.WriteLine("\nИтог хода: \n");
                player1.ShowInfo();
                player2.ShowInfo();

                Console.Write("Нажмите любую кнопку, чтобы продолжить....");
                Console.ReadKey();
                round++;

                if (player1.IsDead() == true || player2.IsDead() == true)
                {
                    isSomeoneDead = true;
                }
            }

            Console.Clear();

            if (player1.IsDead() == true && player2.IsDead() == false)
            {
                Console.WriteLine($"Победитель: {player2.ClassName}");
            }
            else if (player2.IsDead() == true && player1.IsDead() == false)
            {
                Console.WriteLine($"Победитель: {player1.ClassName}");
            }
            else if (player1.IsDead() == true && player2.IsDead() == true)
            {
                Console.WriteLine($"Ничья");
            }

            Console.ReadKey();
        }
    }

    class Player
    {
        protected int HealthPoint = 100;
        protected int EnergyPoint = 0;
        protected int MaxHealthPoint;
        protected int ArmorProtection = 0;
        protected int Evasione = 10;
        protected int Accuracy = 0;
        protected int CritChance = 20;
        protected int CritRate = 2;
        protected int CritFail = 1;
        protected int BaseDamage = 5;
        protected int Initiative = 0;
        protected int MinRoll = 1;
        protected int MaxRoll = 21;
        protected int LostEvasione = 10;
        protected bool IsEvaseoneLost = false;
        protected Random random = new Random();
        private string _hit = "Hit";
        private string _fail = "Fail";
        private string _critHit = "CritHit";
        private string _critFail = "CritFail";
        public string ClassName { get; private set; }
               
        public Player(string className = "None")
        {
            ClassName = className;
        }

        public virtual void Attack(Player target)
        {
            string hit;
            int damage;

            hit = MakeHit(target);
            LoseEvasioneCheck(hit);

            if (hit == _fail || hit == _critFail)
            {
                return;
            }
        
            damage = MakeDamage(hit);
            target.TakeDamage(damage);
        }

        public string MakeHit(Player target)
        {
            int DiceRoll = Roll(MinRoll, MaxRoll);
            int TotalRoll = DiceRoll + Accuracy;

            if (DiceRoll <= CritFail)
            {
                Console.WriteLine($"{ClassName} - Атака: {DiceRoll} - критический промах");
                return _critFail;
            }
            else if (DiceRoll >= CritChance)
            {
                Console.WriteLine($"{ClassName} - Атака: {DiceRoll} - критическое попадание");
                return _critHit;
            }

            if (target.Evasione < TotalRoll)
            {
                Console.WriteLine($"{ClassName} - Атака: {DiceRoll} + {Accuracy} = {TotalRoll} > {target.ClassName} уклонение: {target.Evasione} - попадание");
                return _hit;
            }
            else if (target.Evasione >= TotalRoll)
            {
                Console.WriteLine($"{ClassName} - Атака: {DiceRoll} + {Accuracy} = {TotalRoll} <= {target.ClassName} уклонение: {target.Evasione} - промах");
                return _fail;
            }

            return "";
        }

        public int MakeDamage(string hit)
        {
            if (BaseDamage <= 0)
            {
                return 0;
            }

            if (hit == _hit)
            {
                Console.WriteLine($"{ClassName} наносит {BaseDamage} урона");
                return BaseDamage;
            }
            else if (hit == _critHit)
            {
                Console.WriteLine($"{ClassName} наносит: {BaseDamage} * {CritRate} = {BaseDamage * CritRate} урона");
                return BaseDamage * CritRate;
            }

            return 0;
        }

        public void TakeDamage(int takenDamage)
        {
            int totalDamage = takenDamage - ArmorProtection;

            if (totalDamage <= 0)
            {
                totalDamage = 0;
            }

            Console.WriteLine($"{ClassName} поглощает {ArmorProtection} урона и получает {totalDamage} урона");
            HealthPoint -= totalDamage;
        }

        public bool TakeHeal(int healCount)
        {
            int lostHealth = MaxHealthPoint - HealthPoint;

            if (lostHealth >= healCount)
            {
                HealthPoint += healCount;
                return true;
            }

            return false;
        }

        public void ExpendEnergy(int _energyCost)
        {
            EnergyPoint -= _energyCost;
        }

        public void ChangeStats(int[] changes, bool isIncreace)
        {
            if (isIncreace == true)
            {
                ArmorProtection += changes[0];
                Evasione += changes[1];
                Accuracy += changes[2];
                CritChance += changes[3];
                CritRate += changes[4];
                BaseDamage += changes[5];
                Initiative += changes[6];
            }
            else
            {
                ArmorProtection -= changes[0];
                Evasione -= changes[1];
                Accuracy -= changes[2];
                CritChance -= changes[3];
                CritRate -= changes[4];
                BaseDamage -= changes[5];
                Initiative -= changes[6];
            }
        }

        public int RollInitiative()
        {
            int DiceRoll = Roll(MinRoll, MaxRoll);

            if (DiceRoll == 1)
            {
                return 0;
            }

            return DiceRoll + Initiative;
        }

        public int Roll(int minRoll, int maxRoll)
        {
            return random.Next(minRoll, maxRoll);
        }

        public bool IsDead()
        {
            if (HealthPoint <= 0)
            {
                return true;
            }
            return false;
        }

        public void LoseEvasioneCheck(string hit)
        {
            if (hit == _critFail && IsEvaseoneLost == false)
            {
                Console.WriteLine($"{ClassName} подставился под удар, уклонение -{LostEvasione} до следующего хода");
                Evasione -= LostEvasione;
                IsEvaseoneLost = true;
            }
            else if (hit != _critFail && IsEvaseoneLost == true)
            {
                Evasione += LostEvasione;
                IsEvaseoneLost = false;
            }
        }

        public void ShowInfo()
        {
            Console.WriteLine($"{ClassName}\nЗдоровье: {HealthPoint} \nЭнергия: {EnergyPoint} \n");
        }
    }

    class Barbarian : Player
    {
        private string _abilityName = "Ярость";
        private int _abilityRecharge = 10;
        private int _currentRecharge;
        private int _abilityDuration = 5;
        private int _currentDuration;
        private int _armorProtectionBonus = 2;
        private int _baseDamageBonus = 5;
        private bool _isActive = false;

        public Barbarian() : base("Варвар")
        {
            HealthPoint += 50;
            BaseDamage += 5;
            CritRate += 1;
            Accuracy -= 2;
            Initiative -= 1;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"+{_baseDamageBonus} к урону и +{_armorProtectionBonus} к броне на {_abilityDuration} ходов, перезарядка {_abilityRecharge} ходов.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                ArmorProtection += _armorProtectionBonus;
                BaseDamage += _baseDamageBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                ArmorProtection -= _armorProtectionBonus;
                BaseDamage -= _baseDamageBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }
          
            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }
    }

    class Knight : Player
    {
        private string _abilityName = "Стена щитов";
        private int _abilityRecharge = 5;
        private int _currentRecharge;
        private int _abilityDuration = 3;
        private int _currentDuration;
        private int _armorProtectionBonus = 16;
        private int _evasionBonus = -8;
        private bool _isActive = false;

        public Knight() : base("Рыцарь")
        {
            HealthPoint += 20;
            ArmorProtection += 4;
            Evasione -= 2;
            Initiative -= 2;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"+{_armorProtectionBonus} к броне и {_evasionBonus} к уклонению на {_abilityDuration} ходов, перезарядка {_abilityRecharge} ходов.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                ArmorProtection += _armorProtectionBonus;
                Evasione += _evasionBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                ArmorProtection -= _armorProtectionBonus;
                Evasione -= _evasionBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }
    }

    class Gladiator : Player
    {
        private string _abilityName = "Боевой клич";
        private int _abilityRecharge = 8;
        private int _currentRecharge;
        private int _abilityDuration = 4;
        private int _currentDuration;
        private int multiplay = 2;
        private int _accuracyBonus = 5;
        private bool _isActive = false;

        public Gladiator() : base("Гладиатор")
        {
            HealthPoint += 30;
            ArmorProtection += 2;
            BaseDamage += 2;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"множит свою броню и урон на {multiplay} и +{_accuracyBonus} к точности на {_abilityDuration} ходов, перезарядка {_abilityRecharge} ходов.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                ArmorProtection *= multiplay;
                BaseDamage *= multiplay;
                Accuracy += _accuracyBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                ArmorProtection /= multiplay;
                BaseDamage /= multiplay;
                Accuracy -= _accuracyBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }
    }

    class Paladin : Player
    {
        private string _abilityName = "Кара";
        private int _abilityRecharge = 5;
        private int _currentRecharge;
        private int _abilityDuration = 1;
        private int _currentDuration;
        private int _baseDamageBonus = 25;
        private int _accuracyBonus = 5;
        private bool _isActive = false;
        private string _magicName = "Возложение рук";
        private int _magicPower = 6;
        private int _energyCost = 1;
        private int _magicRecharge = 2;
        private int _currentMagicRecharge = 0;

        public Paladin() : base("Паладин")
        {
            HealthPoint += 20;
            MaxHealthPoint = HealthPoint;
            EnergyPoint += 25;
            ArmorProtection += 3;
            Accuracy += 1;
            BaseDamage += 3;
            Initiative -= 1;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            UseMagic();
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"+{_baseDamageBonus} урона и +{_accuracyBonus} точности к следующей атаке, перезарядка {_abilityRecharge} ходов.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                BaseDamage += _baseDamageBonus;
                Accuracy += _accuracyBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                BaseDamage -= _baseDamageBonus;
                Accuracy -= _accuracyBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }

        private void UseMagic()
        {
            string magicDescription = $"Лечит себя на {_magicPower} хитов, перезарядка {_magicRecharge} ходов.";

            if (_energyCost <= EnergyPoint && _currentMagicRecharge == 0 && TakeHeal(_magicPower) == true)
            {
                ExpendEnergy(_energyCost);

                _currentMagicRecharge = _magicRecharge;

                Console.WriteLine($"{ClassName} использует {_magicName} и получает: {magicDescription}");
            }

            if (_currentMagicRecharge > 0)
            {
                _currentMagicRecharge--;
            }
        }
    }

    class Berserk : Player
    {
        private string _abilityName = "Боевое безумие";
        private int _abilityRecharge = 4;
        private int _currentRecharge;
        private int _abilityDuration = 3;
        private int _currentDuration;
        private int _baseDamageBonus = 10;
        private int _accuracyBonus = -2;
        private int _initiativeBonus = 5;
        private bool _isActive = false;

        public Berserk() : base("Берсерк")
        {
            HealthPoint += 15;
            ArmorProtection += 1;
            BaseDamage += 8;
            Evasione -= 3;
            Initiative += 1;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"+{_baseDamageBonus} урона, +{_initiativeBonus} к инициативе, {_accuracyBonus} к точности, перезарядка {_abilityRecharge} ходов, длительность {_abilityDuration} ходов.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                BaseDamage += _baseDamageBonus;
                Accuracy += _accuracyBonus;
                Initiative += _initiativeBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                BaseDamage -= _baseDamageBonus;
                Accuracy -= _accuracyBonus;
                Initiative -= _initiativeBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }
    }

    class Hunter : Player
    {
        private string _trickName = "Капкан";
        private int _trickRecharge = 6;
        private int _currentTrickRecharge = 0;
        private int _trickDuration = 1;
        private int _currentTrickDuration = 0;
        private int _trickDamage = 15;
        private int _evasionBonus = 5;
        private int _initiativeBonus = 5;
        private bool _isActive = false;

        public Hunter() : base("Охотник")
        {
            ArmorProtection += 1;
            BaseDamage += 1;
            CritChance -= 1;
            CritRate += 1;
            Evasione += 2;
            Accuracy += 2;
            Initiative += 1;
        }

        public override void Attack(Player target)
        {
            UseTrick(target);
            base.Attack(target);
        }

        private void UseTrick(Player target)
        {
            string trickDescription = $"{_trickDamage} урона, -{_evasionBonus} уклонения, -{_initiativeBonus} инициативы на один ход, перезарядка {_trickRecharge} ходов.";

            if (_currentTrickRecharge == 0)
            {
                _currentTrickRecharge = _trickRecharge;
                _currentTrickDuration = _trickDuration;

                Console.WriteLine($"{ClassName} использует {_trickName}, {target.ClassName} получает: {trickDescription}");

                target.TakeDamage(_trickDamage);
                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionBonus,
                    0,
                    0,
                    0,
                    0,
                    _initiativeBonus
                }, false);

                _isActive = true;
            }

            if (_currentTrickDuration == 0 && _isActive == true)
            {
                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionBonus,
                    0,
                    0,
                    0,
                    0,
                    _initiativeBonus
                }, true);

                _isActive = false;
            }

            if (_currentTrickDuration > 0)
            {
                _currentTrickDuration--;
            }

            if (_currentTrickRecharge > 0)
            {
                _currentTrickRecharge--;
            }
        }
    }

    class Rogue : Player
    {
        private string _trickName = "Грязь в лицо";
        private int _trickRecharge = 3;
        private int _currentTrickRecharge = 0;
        private int _trickDuration = 1;
        private int _currentTrickDuration = 0;
        private int _evasionBonus = 5;
        private int _accuracyBonus = 5;
        private int _initiativeBonus = 5;
        private bool _isActive = false;

        public Rogue() : base("Плут")
        {
            HealthPoint -= 20;
            Evasione += 6;
            BaseDamage -= 1;
            CritChance -= 2;
            CritRate += 2;
            Accuracy += 3;
            Initiative += 3;
        }

        public override void Attack(Player target)
        {
            UseTrick(target);
            base.Attack(target);
        }

        private void UseTrick(Player target)
        {
            string trickDescription = $"-{_evasionBonus} уклонения, -{_accuracyBonus} точность, -{_initiativeBonus} инициативы и морального унижения на 1 ход, перезарядка {_trickRecharge} ходов.";

            if (_currentTrickRecharge == 0)
            {
                _currentTrickRecharge = _trickRecharge;
                _currentTrickDuration = _trickDuration;

                Console.WriteLine($"{ClassName} использует {_trickName}, {target.ClassName} получает: {trickDescription}");

                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionBonus,
                    _accuracyBonus,
                    0,
                    0,
                    0,
                    _initiativeBonus
                }, false);

                _isActive = true;
            }

            if (_currentTrickDuration == 0 && _isActive == true)
            {
                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionBonus,
                    _accuracyBonus,
                    0,
                    0,
                    0,
                    _initiativeBonus
                }, true);

                _isActive = false;
            }

            if (_currentTrickDuration > 0)
            {
                _currentTrickDuration--;
            }

            if (_currentTrickRecharge > 0)
            {
                _currentTrickRecharge--;
            }
        }
    }

    class Monk : Player
    {
        private string _abilityName = "Стойка дракона";
        private int _abilityRecharge = 1;
        private int _currentRecharge = 0;
        private int _abilityDuration = 1;
        private int _currentDuration = 0;
        private int _armorProtectionBonus = 2;
        private int _baseDamageBonus = 2;

        private string _trickName = "Унижающая мудрость";
        private int _trickRecharge = 2;
        private int _currentTrickRecharge = 0;
        private int _trickDuration = 1;
        private int _currentTrickDuration = 0;
        private int _evasionPenalty = 1;
        private int _accuracyPenalty = 1;
        private int _critChancePenalty = -1;
        private int _critRatePenalty = 1;
        private int _baseDamagePenalty = 1;
        private int _initiativePenalty = 1;
        private bool _isActive = false;

        public Monk() : base("Монах")
        {
            Evasione += 8;
            Accuracy += 5;
            Initiative += 4;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            UseTrick(target);
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"+{_armorProtectionBonus} брони, +{_baseDamageBonus} урона.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                ArmorProtection += _armorProtectionBonus;
                BaseDamage += _baseDamageBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                ArmorProtection -= _armorProtectionBonus;
                BaseDamage -= _baseDamageBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }

        private void UseTrick(Player target)
        {
            string trickDescription = "Моральное унижение (все параметры -1).";

            if (_currentTrickRecharge == 0)
            {
                _currentTrickRecharge = _trickRecharge;
                _currentTrickDuration = _trickDuration;

                Console.WriteLine($"{ClassName} использует {_trickName}, {target.ClassName} получает: {trickDescription}");

                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionPenalty,
                    _accuracyPenalty,
                    _critChancePenalty,
                    _critRatePenalty,
                    _baseDamagePenalty,
                    _initiativePenalty
                }, false);

                _isActive = true;
            }

            if (_currentTrickDuration == 0 && _isActive == true)
            {
                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionPenalty,
                    _accuracyPenalty,
                    _critChancePenalty,
                    _critRatePenalty,
                    _baseDamagePenalty,
                    _initiativePenalty
                }, true);

                _isActive = false;
            }

            if (_currentTrickDuration > 0)
            {
                _currentTrickDuration--;
            }

            if (_currentTrickRecharge > 0)
            {
                _currentTrickRecharge--;
            }
        }
    }

    class Assasin : Player
    {
        private string _trickName = "Подлая атака скрытым оружием";
        private int _trickRecharge = 6;
        private int _currentTrickRecharge = 0;

        public Assasin() : base("Убийца")
        {
            HealthPoint += 10;
            ArmorProtection += 1;
            BaseDamage -= 1;
            Evasione += 5;
            CritRate += 4;
            CritChance -= 5;
            Initiative += 2;
        }

        public override void Attack(Player target)
        {
            UseTrick(target);
            base.Attack(target);
        }

        private void UseTrick(Player target)
        {
            int trickDamage = BaseDamage * CritRate;
            string trickDescription = $"{trickDamage} урона.";

            if (_currentTrickRecharge == 0)
            {
                _currentTrickRecharge = _trickRecharge;

                Console.WriteLine($"{ClassName} использует {_trickName}, {target.ClassName} получает: {trickDescription}");

                target.TakeDamage(trickDamage);
            }

            if (_currentTrickRecharge > 0)
            {
                _currentTrickRecharge--;
            }
        }
    }

    class Trickster : Player
    {
        private string _trickName = "Гипнотические часы";
        private int _trickRecharge = 6;
        private int _currentTrickRecharge = 0;
        private int _trickDuration = 2;
        private int _currentTrickDuration = 0;
        private int _evasionPenalty = 10;
        private int _accuracyPenalty = 10;
        private bool _isActive = false;

        public Trickster() : base("Трюкач")
        {
            ArmorProtection += 1;
            Evasione += 3;
            Accuracy += 3;
            Initiative += 4;
        }

        public override void Attack(Player target)
        {
            UseTrick(target);
            base.Attack(target);
        }

        private void UseTrick(Player target)
        {
            string trickDescription = $"-{_evasionPenalty} уклонения, -{_accuracyPenalty} точности, на {_trickDuration} ходов, перезарядка {_trickRecharge} ходов.";

            if (_currentTrickRecharge == 0)
            {
                _currentTrickRecharge = _trickRecharge;
                _currentTrickDuration = _trickDuration;

                Console.WriteLine($"{ClassName} использует {_trickName}, {target.ClassName} получает: {trickDescription}");

                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionPenalty,
                    _accuracyPenalty,
                    0,
                    0,
                    0,
                    0
                }, false);

                _isActive = true;
            }

            if (_currentTrickDuration == 0 && _isActive == true)
            {
                target.ChangeStats(new int[7]
                {
                    0,
                    _evasionPenalty,
                    _accuracyPenalty,
                    0,
                    0,
                    0,
                    0
                }, true);

                _isActive = false;
            }

            if (_currentTrickDuration > 0)
            {
                _currentTrickDuration--;
            }

            if (_currentTrickRecharge > 0)
            {
                _currentTrickRecharge--;
            }
        }
    }

    class Mage : Player
    {
        private string _magicName = "Шар огня";
        private int _magicPower = 40;
        private int _energyCost = 5;
        private int _magicRecharge = 3;
        private int _currentMagicRecharge = 0;

        public Mage() : base("Маг")
        {
            HealthPoint -= 30;
            EnergyPoint += 50;
            BaseDamage -= 3;
        }

        public override void Attack(Player target)
        {
            UseMagic(target);
            base.Attack(target);
        }

        private void UseMagic(Player target)
        {
            string magicDescription = $"{_magicPower} урона, перезарядка {_magicRecharge} ходов.";

            if (_energyCost <= EnergyPoint && _currentMagicRecharge == 0)
            {
                ExpendEnergy(_energyCost);

                _currentMagicRecharge = _magicRecharge;
         
                Console.WriteLine($"{ClassName} использует {_magicName}, {target.ClassName} получает: {magicDescription}");

                target.TakeDamage(_magicPower);
            }

            if (_currentMagicRecharge > 0)
            {
                _currentMagicRecharge--;
            }
        }
    }

    class Shaman : Player
    {
        private string _magicName = "Духовный оберег";
        private int _magicPower = 5;
        private int _energyCost = 6;
        private int _magicRecharge = 3;
        private int _currentMagicRecharge = 0;
        private int _magicDuration = 3;
        private int _currentMagicDuration = 0;
        private bool _isActive = false;

        public Shaman() : base("Шаман")
        {
            HealthPoint += 15;
            EnergyPoint += 30;
            Accuracy += 1;
            Evasione += 1;
            Initiative -= 1;
        }

        public override void Attack(Player target)
        {
            UseMagic(target);
            base.Attack(target);
        }

        private void UseMagic(Player target)
        {
            string magicDescription = $"+{_magicPower} к броне и уклонению, на {_magicDuration} ходов, перезарядка {_magicRecharge} ходов.";

            if (_energyCost <= EnergyPoint && _currentMagicRecharge == 0)
            {
                ExpendEnergy(_energyCost);

                _currentMagicRecharge = _magicRecharge;
                _currentMagicDuration = _magicDuration;

                Console.WriteLine($"{ClassName} использует {_magicName} и получает: {magicDescription}");

                _isActive = true;

                ArmorProtection += _magicPower;
                Evasione += _magicPower;
            }

            if (_currentMagicDuration == 0 && _isActive == true)
            {
                ArmorProtection -= _magicPower;
                Evasione -= _magicPower;
            }

            if (_currentMagicRecharge > 0)
            {
                _currentMagicRecharge--;
            }

            if (_currentMagicDuration > 0)
            {
                _currentMagicDuration--;
            }
        }
    }

    class Warlock : Player
    {
        private string _trickName = "Атака фамильяра";
        private int _trickDamage = 8;

        private string _magicName = "Проклятье";
        private int _magicPower = 10;
        private int _energyCost = 10;
        private int _magicRecharge = 5;
        private int _currentMagicRecharge = 0;
        private int _magicDuration = 5;
        private int _currentMagicDuration = 0;
        private bool _isActive = false;

        public Warlock() : base("Чернокнижник")
        {
            HealthPoint -= 30;
            EnergyPoint += 50;
            BaseDamage -= 3;
        }

        public override void Attack(Player target)
        {
            UseMagic(target);
            UseTrick(target);
            base.Attack(target);
        }

        private void UseTrick(Player target)
        {
            string trickDescription = $"{_trickDamage} урона от фамильяра.";

            Console.WriteLine($"{ClassName} использует {_trickName}, {target.ClassName} получает: {trickDescription}");

            target.TakeDamage(_trickDamage);
        }

        private void UseMagic(Player target)
        {
            string magicDescription = $"{_magicPower} штраф к характеристикам на {_magicDuration} ходов, перезарядка {_magicRecharge} ходов.";

            if (_energyCost <= EnergyPoint && _currentMagicRecharge == 0)
            {
                ExpendEnergy(_energyCost);

                _currentMagicRecharge = _magicRecharge;
                _currentMagicDuration = _magicDuration;

                Console.WriteLine($"{ClassName} использует {_magicName}, {target.ClassName} получает: {magicDescription}");

                _isActive = true;

                target.ChangeStats(new int[7] {
                    0,
                    _magicPower,
                    _magicPower,
                    -_magicPower,
                    _magicPower,
                    _magicPower,
                    _magicPower
                }, false);
            }

            if (_currentMagicDuration == 0 && _isActive == true)
            {
                target.ChangeStats(new int[7] {
                    0,
                    _magicPower,
                    _magicPower,
                    -_magicPower,
                    _magicPower,
                    _magicPower,
                    _magicPower
                }, true);

                _isActive = false;
            }

            if (_currentMagicRecharge > 0)
            {
                _currentMagicRecharge--;
            }

            if (_currentMagicDuration > 0)
            {
                _currentMagicDuration--;
            }
        }
    }

    class Priest : Player
    {
        private string _abilityName = "Bonk";
        private int _abilityRecharge = 5;
        private int _currentRecharge;
        private int _abilityDuration = 1;
        private int _currentDuration;
        private int _baseDamageBonus = 25;
        private int _accuracyBonus = 5;
        private bool _isActive = false;

        private string _magicName = "Слово лечения";
        private int _magicPower = 20;
        private int _energyCost = 4;
        private int _magicRecharge = 3;
        private int _currentMagicRecharge = 0;

        public Priest() : base("Жрец")
        {
            HealthPoint += 15;
            MaxHealthPoint = HealthPoint;
            EnergyPoint += 20;
            ArmorProtection += 2;
            Accuracy += 2;
            BaseDamage += 1;
        }

        public override void Attack(Player target)
        {
            UseAbility();
            UseMagic();
            base.Attack(target);
        }

        private void UseAbility()
        {
            string abilityDescription = $"+{_baseDamageBonus} урона и +{_accuracyBonus} точности к следующей атаке, перезарядка {_abilityRecharge} ходов.";

            if (_currentRecharge == 0)
            {
                _isActive = true;

                BaseDamage += _baseDamageBonus;
                Accuracy += _accuracyBonus;

                _currentRecharge = _abilityRecharge;
                _currentDuration = _abilityDuration;

                Console.WriteLine($"{ClassName} использует {_abilityName} и получает: {abilityDescription}");
            }

            if (_currentDuration == 0 && _isActive == true)
            {
                _isActive = false;

                BaseDamage -= _baseDamageBonus;
                Accuracy -= _accuracyBonus;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration > 0)
            {
                _currentDuration--;
            }
        }

        private void UseMagic()
        {
            string magicDescription = $"Лечит себя на {_magicPower} хитов, перезарядка {_magicRecharge} ходов.";

            if (_energyCost <= EnergyPoint && _currentMagicRecharge == 0 && TakeHeal(_magicPower) == true)
            {
                ExpendEnergy(_energyCost);

                _currentMagicRecharge = _magicRecharge;

                Console.WriteLine($"{ClassName} использует {_magicName} и получает: {magicDescription}");
            }

            if (_currentMagicRecharge > 0)
            {
                _currentMagicRecharge--;
            }
        }
    }

    class Summoner : Player
    {
        private string _magicName = "Призыв паука";
        private int _magicPower = 13;
        private int _energyCost = 5;
        private int _magicRecharge = 1;
        private int _currentRecharge = 0;
        private int _magicDuration = 5;
        private int _currentDuration = 0;
        private bool _isActive = false;

        public Summoner() : base("Призыватель")
        {
            HealthPoint -= 20;
            EnergyPoint += 40;
            ArmorProtection += 2;
            BaseDamage -= 2;
        }

        public override void Attack(Player target)
        {
            UseMagic(target);
            base.Attack(target);
        }

        private void UseMagic(Player target)
        {
            string magicDescription = $"Призван паук с уроном в {_magicPower} ед. на {_magicDuration} ходов.";

            if (_currentRecharge == 0 && _isActive == false)
            {
                ExpendEnergy(_energyCost);

                _isActive = true;

                Console.WriteLine($"{ClassName} использует {_magicName}: {magicDescription}");

                _currentRecharge = _magicRecharge;
                _currentDuration = _magicDuration;
            }

            if (_currentDuration > 0 && _isActive == true)
            {
                Console.WriteLine($"Паук атакует {target.ClassName}");
                target.TakeDamage(_magicPower);
                _currentDuration--;
            }

            if (_currentRecharge > 0)
            {
                _currentRecharge--;
            }

            if (_currentDuration == 0)
            {
                _isActive = false;
            }
        }
    }
}
